---
title: 对付反爬虫战略
type: tags
date: 2017-09-10 23:50:00
tags: 
     - NODE
     - 开发总结
---

一开始我的反爬思路是这样的：

1.设置几秒请求一次（这边还可以对请求头处理假装浏览器访问）


2.对付验证码

接入打码平台。

下载验证码  上传验证码 

3.ip代理

获取验证码字符  填写验证码

说起爬虫，真是磕磕绊绊…

<!-- more -->

前段时间想着即将成为大四狗了，校招如火如荼，本前端狗刚好学了点后端技术（nodejs，PHP），那就用技术做点有意义的事，爬虫爬取厦门地区的校招信息（大概完成）（之后再爬个宣讲信息），然后建个招聘信息发布（已完成），求职交流系统（已完成），然后再造一些求职工具（代做），如简历生成器。时间充沛的话用socket.ioc写一个求职线上交流平台（实习狗时间一直很捉急）。

讲了些有的没的，开始说爬虫过程。

首先，爬虫思路是这样，先把我要爬的网站打开，看想要爬什么，我是爬一个校招网站。先把该内容的首页的文章列表根据分类一个一个爬下来，其中你会看到里面可以爬到每篇文章的url，然后就是访问通过这些url，把每篇文章的具体内容爬取下来，接着就是存到数据库了。

思路是不是很简单？！这种菜鸟级别的爬虫适合我这菜鸟…第一次基本把近五百条具体内容爬下来了，很受鼓舞…不知道玩到第几次，忽然还没爬到一百条就挂了，刷新网站才知道，被怀疑是爬虫，需要填验证码。

好好好，验证码是吧，我去找解决办法，疯狂Google，总结如下，分免费的和付费的。免费的就是用Tesseract开源的OCR识别工具识别验证码，当然还需要graphicsmagick这个图像处理工具的辅助来提高基本的识别率，然并卵....清晰简单的验证码识别率还行，那个校招网站的验证码我试了下，正确率惨不忍睹....是可以去训练tesseract，提高相近字符的识别率...有大把空余时间了再说吧，前端大把东西等我去研究呢。付费的就是让打码平台帮你识别验证码，这个之后可以考虑。

实践一

当然，怎么可以一下子就屈服呢，至少要挣扎反抗到无力嘛。开始了反反爬虫，一开始，我有点小屈服，最新的校招信息能爬下来就行，甚至做了最后的退路---让用户直接点击链接跳转到具体的网，我就展示校招大体信息就好。之前写出来爬虫的效果是日期靠后的那些能爬下来，这个简单，用articleList.reverse()反转组数，这样就把最新的校招信息爬下来了，然而，只爬了六十几篇。。羞愧。。。

实践二

想想对方的反爬虫技术是根据啥来判断是爬虫然后弹出验证码，可能根据ip，短时间请求次数等等，相对更换不同IP地址，短时间请求次数实验成本更低。。然后我给爬虫程序加了定时器setTimeout()，6秒发送一次请求。结果爬了九十多篇。。。这么久爬一次竟然没啥用。。。不科学(*@ο@*) 。

实践三

换个思路，会不会除了对时间访问次数的判断，还加了如果相隔访问时间一致的话也被判为爬虫的判断？

那我发送请求的相隔时间就 随机嘛，

```

vartime=Math.floor(Math.random()*(6-1)+1);

vardelay=time*1000;

```

1-5秒随机发送请求。

结果。。。。可以了！！！！！

六百多（更新得越来越多了）篇文章全爬下来了

看来就是根据访问时间和频率来判断的。

以防ip被封，我把请求头



然后，爬虫总不能每天都手动去点爬虫开关吧，借用这两个第三方模块可以定时执行任务

varspawn=require('child_process').spawn;

varcronJob=require('cron').CronJob;

// 定时执行爬虫

exports.autoUpdate='30 20 19 * * *';// 每天19：20：30 执行一次任务

varjob=newcronJob(config.autoUpdate,function(){

console.log('开始执行定时更新任务');

varupdate=spawn(process.execPath,[path.resolve(__dirname,'./model/all.js')]);

update.stdout.pipe(process.stdout);

update.stderr.pipe(process.stderr);

update.on('close',function(code) {

console.log('更新任务结束，代码=%d', code);

});

});

job.start();

---------
更新：
目前爬了一千多篇，期间ip还是被封了
然后我使用ip代理来解决这个问题

方法在这：
[代理列表 + 用代理访问目标网站](https://segmentfault.com/q/1010000008196143)